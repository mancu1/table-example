# –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –≤ SUM

## –û–±–∑–æ—Ä

–¢–∞–±–ª–∏—á–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏** –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –∏ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–∞—Ö:

```
=SUM(A1:C2)         # –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π
=SUM($A$1:$C$2)     # –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–±—Å–æ–ª—é—Ç–Ω—ã–π
=SUM($A1:$C2)       # –°—Ç–æ–ª–±—Ü—ã –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ, —Å—Ç—Ä–æ–∫–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ
=SUM(A$1:C$2)       # –°—Ç—Ä–æ–∫–∏ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ, —Å—Ç–æ–ª–±—Ü—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ
=SUM($A$1:C2)       # –ù–∞—á–∞–ª–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ, –∫–æ–Ω–µ—Ü –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π
=SUM(A1:$C$2)       # –ù–∞—á–∞–ª–æ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ, –∫–æ–Ω–µ—Ü –∞–±—Å–æ–ª—é—Ç–Ω—ã–π
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–∞—Ä—Å–∏–Ω–≥

–ö–∞–∂–¥–∞—è —á–∞—Å—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –ø–∞—Ä—Å–∏—Ç—Å—è **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ** —á–µ—Ä–µ–∑ `parseReference()`:

```typescript
// =SUM($A$1:C2)
const start = parseReference('$A$1', basePos, rowAxis, colAxis);
// ‚Üí { rowMode: 'abs', colMode: 'abs', dRow: ..., dCol: ... }

const end = parseReference('C2', basePos, rowAxis, colAxis);
// ‚Üí { rowMode: 'rel', colMode: 'rel', dRow: ..., dCol: ... }
```

### –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ/—É–¥–∞–ª–µ–Ω–∏–∏

–ö–∞–∂–¥—ã–π —è–∫–æ—Ä—å (start –∏ end) —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ**:

```typescript
function transformAnchor(anchor, splice) {
  if (anchor.rowMode === 'rel') {
    // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–∞—è - —Ü–µ–ª—å —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å —è—á–µ–π–∫–æ–π
    newTargetPos = applySpliceToPos(targetPos);
  } else {
    // –ê–±—Å–æ–ª—é—Ç–Ω–∞—è - —Ü–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ–π –∂–µ –ø–æ–∑–∏—Ü–∏–∏
    newTargetPos = targetPos;
  }
  // ...
}
```

## –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω

```
–î–û:
A1: 10    B1: 20    C1: 30
A2: 40    B2: 50    C2: 60
A4: =SUM(A1:C2) ‚Üí 210

–í—Å—Ç–∞–≤–∫–∞ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é 2:

–ü–û–°–õ–ï:
A1: 10    B1: 20    C1: 30
A2: (–ø—É—Å—Ç–æ)
A3: 40    B3: 50    C3: 60
A5: =SUM(A1:C3) ‚Üí 210  ‚úÖ –î–∏–∞–ø–∞–∑–æ–Ω —Ä–∞—Å—à–∏—Ä–∏–ª—Å—è!
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–ª–Ω–æ—Å—Ç—å—é –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω

```
–î–û:
A1: 10    B1: 20    C1: 30
A2: 40    B2: 50    C2: 60
B4: =SUM($A$1:$C$2) ‚Üí 210

–í—Å—Ç–∞–≤–∫–∞ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é 2:

–ü–û–°–õ–ï:
A1: 10    B1: 20    C1: 30
A2: (–ø—É—Å—Ç–æ)
A3: 40    B3: 50    C3: 60
B5: =SUM($A$1:$C$2) ‚Üí 60  ‚úÖ –î–∏–∞–ø–∞–∑–æ–Ω –æ—Å—Ç–∞–ª—Å—è –Ω–∞ A1:C2 (—Ç–µ–ø–µ—Ä—å A1:C1 + –ø—É—Å—Ç–∞—è)
```

–ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å —Å 210 –Ω–∞ 60, –ø–æ—Ç–æ–º—É —á—Ç–æ:
- –î–∏–∞–ø–∞–∑–æ–Ω `$A$1:$C$2` –æ—Å—Ç–∞–ª—Å—è –Ω–∞ **—Ç–µ—Ö –∂–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö** (—Å—Ç—Ä–æ–∫–∏ 1-2, —Å—Ç–æ–ª–±—Ü—ã A-C)
- –ü–æ—Å–ª–µ –≤—Å—Ç–∞–≤–∫–∏ —Å—Ç—Ä–æ–∫–∞ 2 —Å—Ç–∞–ª–∞ –ø—É—Å—Ç–æ–π
- –°—É–º–º–∞ = 10+20+30 (—Å—Ç—Ä–æ–∫–∞ 1) + 0+0+0 (—Å—Ç—Ä–æ–∫–∞ 2) = 60

### –ü—Ä–∏–º–µ—Ä 3: –°–º–µ—à–∞–Ω–Ω—ã–π (—Å—Ç–æ–ª–±—Ü—ã –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ)

```
–î–û:
A1: 10    B1: 20    C1: 30
A2: 40    B2: 50    C2: 60
C4: =SUM($A1:$C2) ‚Üí 210

–í—Å—Ç–∞–≤–∫–∞ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é 2:

–ü–û–°–õ–ï:
C5: =SUM($A1:$C3) ‚Üí 210  ‚úÖ –°—Ç–æ–ª–±—Ü—ã A-C –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã, —Å—Ç—Ä–æ–∫–∏ —Å–¥–≤–∏–Ω—É–ª–∏—Å—å
```

### –ü—Ä–∏–º–µ—Ä 4: –°–º–µ—à–∞–Ω–Ω—ã–π (—Å—Ç—Ä–æ–∫–∏ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ)

```
–î–û:
A1: 10    B1: 20    C1: 30
A2: 40    B2: 50    C2: 60
D4: =SUM(A$1:C$2) ‚Üí 210

–í—Å—Ç–∞–≤–∫–∞ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é 2:

–ü–û–°–õ–ï:
D5: =SUM(A$1:C$2) ‚Üí 60  ‚úÖ –°—Ç—Ä–æ–∫–∏ 1-2 –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã
```

### –ü—Ä–∏–º–µ—Ä 5: –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω

```
–î–û:
A1: 1     B1: 2     C1: 3
A2: =SUM($A$1:C1) ‚Üí 6

–í—Å—Ç–∞–≤–∫–∞ —Å—Ç–æ–ª–±—Ü–∞ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é 2:

–ü–û–°–õ–ï:
A2: =SUM($A$1:D1) ‚Üí 6  ‚úÖ –ù–∞—á–∞–ª–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ, –∫–æ–Ω–µ—Ü —Ä–∞—Å—à–∏—Ä–∏–ª—Å—è
```

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã

```
=SUM(A1:C1)
```

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–≥–¥–∞:**
- –ö–æ–ø–∏—Ä—É–µ—Ç–µ —Ñ–æ—Ä–º—É–ª—É –≤–Ω–∏–∑ –ø–æ —Å—Ç—Ä–æ–∫–∞–º
- –•–æ—Ç–∏—Ç–µ —á—Ç–æ–±—ã –¥–∏–∞–ø–∞–∑–æ–Ω "–¥–≤–∏–≥–∞–ª—Å—è" –≤–º–µ—Å—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏
- –í—Å—Ç–∞–≤–∫–∏/—É–¥–∞–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Ä–∞—Å—à–∏—Ä—è—Ç—å/—Å–∂–∏–º–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω

**–ü—Ä–∏–º–µ—Ä:** –ü–æ–¥—Å—á–µ—Ç —Å—É–º–º—ã –ø–æ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ —Ç–∞–±–ª–∏—Ü—ã

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã

```
=SUM($A$1:$C$10)
```

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–≥–¥–∞:**
- –ù—É–∂–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞–Ω–Ω—ã—Ö
- –ö–æ–ø–∏—Ä—É–µ—Ç–µ —Ñ–æ—Ä–º—É–ª—É –≤ —Ä–∞–∑–Ω—ã–µ –º–µ—Å—Ç–∞, –Ω–æ –¥–∏–∞–ø–∞–∑–æ–Ω –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Ç–µ–º –∂–µ
- –í—Å—Ç–∞–≤–∫–∏/—É–¥–∞–ª–µ–Ω–∏—è –ù–ï –¥–æ–ª–∂–Ω—ã –≤–ª–∏—è—Ç—å –Ω–∞ –¥–∏–∞–ø–∞–∑–æ–Ω

**–ü—Ä–∏–º–µ—Ä:** –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –æ–±—â–µ–π —Å—É–º–º—ã (–¥–µ–ª–∏—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ)

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–º–µ—à–∞–Ω–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã

```
=SUM($A1:$C1)  # –°—Ç–æ–ª–±—Ü—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã
=SUM(A$1:C$10) # –°—Ç—Ä–æ–∫–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã
```

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–≥–¥–∞:**
- –ù—É–∂–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω—É –æ—Å—å, –Ω–æ –Ω–µ –¥—Ä—É–≥—É—é
- –°–æ–∑–¥–∞–µ—Ç–µ —Ç–∞–±–ª–∏—Ü—ã —Å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–º–∏ –∏—Ç–æ–≥–∞–º–∏
- –í—ã—á–∏—Å–ª—è–µ—Ç–µ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–µ —Å—É–º–º—ã

**–ü—Ä–∏–º–µ—Ä:** –°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–¥–∞ –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º A-C, –Ω–æ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–æ–∫

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```typescript
type Anchor = {
  base: Address;           // –ê–¥—Ä–µ—Å —è—á–µ–π–∫–∏ —Å —Ñ–æ—Ä–º—É–ª–æ–π
  rowMode: 'rel' | 'abs';  // –†–µ–∂–∏–º –¥–ª—è —Å—Ç—Ä–æ–∫–∏
  colMode: 'rel' | 'abs';  // –†–µ–∂–∏–º –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞
  dRow: number;            // –°–º–µ—â–µ–Ω–∏–µ –ø–æ —Å—Ç—Ä–æ–∫–µ
  dCol: number;            // –°–º–µ—â–µ–Ω–∏–µ –ø–æ —Å—Ç–æ–ª–±—Ü—É
};

type RangeRef = {
  start: Anchor;  // –ù–∞—á–∞–ª–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (—Å–æ —Å–≤–æ–∏–º–∏ —Ä–µ–∂–∏–º–∞–º–∏)
  end: Anchor;    // –ö–æ–Ω–µ—Ü –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (—Å–æ —Å–≤–æ–∏–º–∏ —Ä–µ–∂–∏–º–∞–º–∏)
};
```

### –ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º

```typescript
const match = ref.match(/^(\$?)([A-Z]+)(\$?)(\d+)$/);
//                        ^      ^        ^    ^
//                        |      |        |    ‚îî‚îÄ –ù–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏
//                        |      |        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ $ –ø–µ—Ä–µ–¥ —Å—Ç—Ä–æ–∫–æ–π?
//                        |      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ë—É–∫–≤—ã —Å—Ç–æ–ª–±—Ü–∞
//                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ $ –ø–µ—Ä–µ–¥ —Å—Ç–æ–ª–±—Ü–æ–º?

const colAbs = match[1] === '$';
const rowAbs = match[3] === '$';
```

### –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è

```typescript
transformRange(range, splice) {
  // –ö–∞–∂–¥—ã–π —è–∫–æ—Ä—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
  const newStart = transformAnchor(range.start, splice);
  const newEnd = transformAnchor(range.end, splice);
  
  return { start: newStart, end: newEnd };
}
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–∞–∂–º–∏—Ç–µ **"–ü—Ä–∏–º–µ—Ä 4: SUM (–∞–±—Å–æ–ª—é—Ç–Ω—ã–µ)"**
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã –≤ —Å—Ç—Ä–æ–∫–µ 4
4. –í—Å—Ç–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É –º–µ–∂–¥—É 1 –∏ 2
5. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∫–∞–∫ —Ñ–æ—Ä–º—É–ª—ã —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É!

## –û—Ç–ª–∞–¥–∫–∞

–í **–ø–∞–Ω–µ–ª–∏ –æ—Ç–ª–∞–¥–∫–∏** –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —è–∫–æ—Ä–µ–π:

```json
{
  "A4": {
    "type": "formula",
    "formula": "=SUM($A$1:$C$2)",
    "ast": {
      "t": "Sum",
      "range": {
        "start": {
          "rowMode": "abs",
          "colMode": "abs",
          "dRow": -3,
          "dCol": 0
        },
        "end": {
          "rowMode": "abs",
          "colMode": "abs",
          "dRow": -2,
          "dCol": 2
        }
      }
    }
  }
}
```

## –ò—Ç–æ–≥–æ

‚úÖ –í—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏  
‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —è–∫–æ—Ä–µ–π  
‚úÖ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Excel/Google Sheets  
‚úÖ –ù–∞–≥–ª—è–¥–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö  

**–ù–∏–∫–∞–∫–æ–≥–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è!** –ü–∞—Ä—Å–µ—Ä —É–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –±–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å —è–∫–æ—Ä—è–º–∏. üéØ

